{% extends 'base.html' %}
{% import 'macros.html' as macros %}
{% block content %}
<h1>Benvingut a la app de Flask</h1>

<!-- Mostrar el mensaje de error si no se encuentra el usuario -->
{% if error_message %}
<div class="alert alert-danger">
    <strong>Error:</strong> {{ error_message }}
</div>
{% endif %}

<!-- Si la sesión está iniciada, mostrar el nombre de usuario y el botón de cerrar sesión -->
{% if session.get('username') %}
<h2>Hola, {{ session.get('username') }}!</h2>
<a href="{{ url_for('logout') }}" class="btn btn-danger">Tancar Sessió</a>
{% else %}
<!-- Si la sesión no está iniciada, mostrar el formulario de login -->
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-5 mx-auto">
            <form method="POST">
                {{ login_form.csrf_token }}
                <div class="mb-3">
                    <label for="username">{{ login_form.username.label }}</label>
                    {{ login_form.username(class="form-control") }}
                    {% if login_form.username.errors %}
                    <div class="text-danger">
                        {% for error in login_form.username.errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="password">{{ login_form.password.label }}</label>
                    {{ login_form.password(class="form-control") }}
                </div>
                <div class="mb-3">
                    {{ login_form.submit(class="btn btn-primary") }}
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}

{% if ip %}
<h2>La IP de l'usuari és: {{ ip }}</h2>
{% else %}
<a href="{{ url_for('index') }}">Crear cookie</a>
{% endif %}

{% endblock %}

<!-- Mostrar mensajes flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul>
    {% for category, message in messages %}
    <li class="alert alert-{{ category }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}